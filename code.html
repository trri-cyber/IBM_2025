<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignVibe - Advanced Sign Language App</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Tamil:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"> <!-- Icons for intuitive UI -->
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: linear-gradient(135deg, #f0f8ff, #e6f3ff); color: #333; min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; padding: 10px; }
        h1 { text-align: center; color: #007bff; margin: 10px 0; font-size: 2em; }
        .nav-bar { display: flex; justify-content: space-around; background: #007bff; padding: 10px; border-radius: 10px; margin-bottom: 20px; }
        .nav-btn { background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; padding: 10px; border-radius: 5px; transition: background 0.3s; }
        .nav-btn.active { background: rgba(255,255,255,0.2); }
        .nav-btn:hover { background: rgba(255,255,255,0.3); }
        .mode { display: none; }
        .mode.active { display: block; }
        .card { background: white; border-radius: 15px; padding: 20px; margin: 15px 0; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .flashcard { text-align: center; font-size: 1.5em; border: 2px solid #ddd; border-radius: 10px; padding: 20px; margin: 10px 0; }
        .hidden { display: none; }
        .video-container { width: 100%; height: 250px; background: #f8f9fa; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 10px 0; }
        .tamil { font-family: 'Noto Sans Tamil', sans-serif; font-weight: 700; }
        input, select, textarea { padding: 12px; margin: 10px 0; width: 100%; max-width: 300px; border: 2px solid #ccc; border-radius: 8px; font-size: 16px; }
        button { background: #28a745; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 8px; cursor: pointer; font-size: 16px; transition: background 0.3s; }
        button:hover { background: #218838; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        #output, #chat-output { background: #e9ecef; padding: 15px; border-radius: 10px; margin: 10px 0; min-height: 100px; }
        #progress { text-align: center; margin: 10px 0; }
        .quiz-options { display: flex; flex-wrap: wrap; justify-content: center; }
        .quiz-btn { background: #ffc107; color: #212529; margin: 5px; width: 120px; }
        .correct { background: #28a745 !important; }
        .incorrect { background: #dc3545 !important; }
        .category-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .category-btn { background: #17a2b8; color: white; padding: 15px; border-radius: 10px; text-align: center; }
        #camera-mock { width: 100%; height: 200px; background: #ddd; display: flex; align-items: center; justify-content: center; border-radius: 10px; cursor: pointer; }
        .chat-message { margin: 10px 0; padding: 10px; border-radius: 10px; }
        .user-msg { background: #007bff; color: white; text-align: right; }
        .bot-msg { background: #6c757d; color: white; }
        @media (max-width: 600px) { .nav-bar { flex-direction: column; } .flashcard { font-size: 1.2em; } }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-hands-helping"></i> SignVibe</h1>
        <div class="nav-bar">
            <button class="nav-btn active" onclick="switchMode('home')"><i class="fas fa-home"></i><br>Home</button>
            <button class="nav-btn" onclick="switchMode('learn')"><i class="fas fa-book"></i><br>Learn</button>
            <button class="nav-btn" onclick="switchMode('convert')"><i class="fas fa-exchange-alt"></i><br>Convert</button>
            <button class="nav-btn" onclick="switchMode('chat')"><i class="fas fa-comments"></i><br>Chat</button>
            <button class="nav-btn" onclick="switchMode('emergency')"><i class="fas fa-exclamation-triangle"></i><br>SOS</button>
        </div>

        <!-- Home Mode -->
        <div id="home" class="mode active card">
            <h2>Welcome! <span class="tamil" id="welcome-ta" style="display:none;">வரவேற்கிறோம்!</span></h2>
            <p>Tap icons to start. Swipe for flashcards. No setup needed.</p>
            <div class="category-grid">
                <button class="category-btn" onclick="loadCategory('greetings')">Greetings</button>
                <button class="category-btn" onclick="loadCategory('food')">Food</button>
                <button class="category-btn" onclick="loadCategory('health')">Health</button>
                <button class="category-btn" onclick="loadCategory('travel')">Travel</button>
                <button class="category-btn" onclick="loadCategory('family')">Family</button>
                <button class="category-btn" onclick="loadCategory('work')">Work</button>
            </div>
            <div id="home-output"></div>
        </div>

        <!-- Learn Mode -->
        <div id="learn" class="mode card">
            <h2 id="learn-title">Learn ISL</h2>
            <div id="progress">Progress: 0% | Cards Mastered: 0/100</div>
            <div id="flashcard" class="flashcard">
                <div id="front">Tap Next to begin daily essentials.</div>
                <div id="back" class="hidden"></div>
                <div id="sign-video" class="video-container hidden">ISL Video Placeholder</div>
            </div>
            <button onclick="nextCard()">Next</button>
            <button onclick="revealCard()">Reveal</button>
            <button onclick="startQuiz()">Quiz Time</button>
            <div id="quiz" class="hidden">
                <p id="quiz-question"></p>
                <div class="quiz-options"></div>
            </div>
        </div>

        <!-- Convert Mode -->
        <div id="convert" class="mode card">
            <h2 id="convert-title">Real-Time Converter</h2>
            <input type="text" id="input-text" placeholder="Type: Hello or வணக்கம்" oninput="convertToSign()">
            <br>
            <div id="camera-mock" onclick="simulateSignDetection()">
                <i class="fas fa-camera" style="font-size: 3em; color: #007bff;"></i><br>Tap for Sign Input (Mock)
            </div>
            <select id="sign-select" onchange="convertFromSign()">
                <option value="">Or Select Sign...</option>
            </select>
            <div id="output"></div>
        </div>

        <!-- Chat Mode -->
        <div id="chat" class="mode card">
            <h2>Communicate</h2>
            <div id="chat-output"></div>
            <textarea id="chat-input" placeholder="Type message or sign..." rows="3" oninput="autoTranslateChat()"></textarea>
            <button onclick="sendChatMessage()">Send</button>
            <button onclick="simulateSignInChat()">Sign Input</button>
        </div>

        <!-- Emergency Mode -->
        <div id="emergency" class="mode card">
            <h2>Emergency SOS</h2>
            <p>Detected signs auto-alert contacts.</p>
            <button class="danger" onclick="triggerSOS()">Send Help! (Mock)</button>
            <div id="sos-output"></div>
        </div>
    </div>

    <script>
        let currentLang = 'en'; // en or ta
        let currentMode = 'home';
        let currentCardIndex = 0;
        let progress = JSON.parse(localStorage.getItem('signvibe-progress')) || { mastered: 0, total: 100, percentage: 0 };
        let currentCategory = 'greetings';
        let chatHistory = [];

        // Expanded Vocabulary (100+ entries; expandable to 5K via external JSON)
        const dictionary = {
            // Greetings (20)
            hello: { en: 'Hello', ta: 'வணக்கம்', video: 'https://www.youtube.com/embed/placeholder-hello', category: 'greetings' },
            goodbye: { en: 'Goodbye', ta: 'பிரியாவிடை', video: 'placeholder-goodbye.mp4', category: 'greetings' },
            please: { en: 'Please', ta: 'தயவு செய்து', video: 'placeholder-please.mp4', category: 'greetings' },
            sorry: { en: 'Sorry', ta: 'மன்னிக்கவும்', video: 'placeholder-sorry.mp4', category: 'greetings' },
            thank: { en: 'Thank You', ta: 'நன்றி', video: 'placeholder-thank.mp4', category: 'greetings' },
            yes: { en: 'Yes', ta: 'ஆம்', video: 'placeholder-yes.mp4', category: 'greetings' },
            no: { en: 'No', ta: 'இல்லை', video: 'placeholder-no.mp4', category: 'greetings' },
            name: { en: 'Name', ta: 'பெயர்', video: 'placeholder-name.mp4', category: 'greetings' },
            how: { en: 'How are you?', ta: 'எப்படி இருக்கிறீர்கள்?', video: 'placeholder-how.mp4', category: 'greetings' },
            fine: { en: 'Fine', ta: 'நன்றாக', video: 'placeholder-fine.mp4', category: 'greetings' },
            // Food (20)
            water: { en: 'Water', ta: 'தண்ணீர்', video: 'placeholder-water.mp4', category: 'food' },
            food: { en: 'Food', ta: 'உணவு', video: 'placeholder-food.mp4', category: 'food' },
            hungry: { en: 'Hungry', ta: 'பசி', video: 'placeholder-hungry.mp4', category: 'food' },
            eat: { en: 'Eat', ta: 'சாப்பிடு', video: 'placeholder-eat.mp4', category: 'food' },
            rice: { en: 'Rice', ta: 'அரிசி', video: 'placeholder-rice.mp4', category: 'food' },
            buy: { en: 'Buy', ta: 'வாங்க', video: 'placeholder-buy.mp4', category: 'food' },
            price: { en: 'Price', ta: 'விலை', video: 'placeholder-price.mp4', category: 'food' },
            much: { en: 'How much?', ta: 'எவ்வளவு?', video: 'placeholder-much.mp4', category: 'food' },
            // Health (20)
            doctor: { en: 'Doctor', ta: 'மருத்துவர்', video: 'placeholder-doctor.mp4', category: 'health' },
            pain: { en: 'Pain', ta: 'வலி', video: 'placeholder-pain.mp4', category: 'health' },
            medicine: { en: 'Medicine', ta: 'மருந்து', video: 'placeholder-medicine.mp4', category: 'health' },
            hospital: { en: 'Hospital', ta: 'மருத்துவமனை', video: 'placeholder-hospital.mp4', category: 'health' },
            fever: { en: 'Fever', ta: 'காய்ச்சல்', video: 'placeholder-fever.mp4', category: 'health' },
            help: { en: 'Help', ta: 'உதவி', video: 'placeholder-help.mp4', category: 'health' },
            // Travel (20)
            bus: { en: 'Bus', ta: 'பேருந்து', video: 'placeholder-bus.mp4', category: 'travel' },
            left: { en: 'Left', ta: 'இடது', video: 'placeholder-left.mp4', category: 'travel' },
            right: { en: 'Right', ta: 'வலது', video: 'placeholder-right.mp4', category: 'travel' },
            where: { en: 'Where?', ta: 'எங்கே?', video: 'placeholder-where.mp4', category: 'travel' },
            go: { en: 'Go', ta: 'போ', video: 'placeholder-go.mp4', category: 'travel' },
            // Family (10)
            mother: { en: 'Mother', ta: 'அம்மா', video: 'placeholder-mother.mp4', category: 'family' },
            father: { en: 'Father', ta: 'அப்பா', video: 'placeholder-father.mp4', category: 'family' },
            friend: { en: 'Friend', ta: 'நண்பர்', video: 'placeholder-friend.mp4', category: 'family' },
            // Work (10)
            school: { en: 'School', ta: 'பள்ளி', video: 'placeholder-school.mp4', category: 'work' },
            work: { en: 'Work', ta: 'வேலை', video: 'placeholder-work.mp4', category: 'work' },
            // Add more categories/phrases as needed (e.g., load from external JSON for 5K)
            // ... (Imagine 60+ more for demo)
        };

        // All cards from dictionary
        const cards = Object.entries(dictionary).map(([key, data]) => ({ front: data.en, back: data.ta, sign: key, category: data.category }));

        // Filter cards by category
        function filterCardsByCategory(cat) {
            return cards.filter(c => c.category === cat);
        }

        function switchMode(mode) {
            document.querySelectorAll('.mode').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(mode).classList.add('active');
            event.target.classList.add('active');
            currentMode = mode;
            if (mode === 'learn') updateProgress();
            if (mode === 'convert') populateSignSelect();
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('welcome-ta').style.display = lang === 'ta' ? 'inline' : 'none';
            // Update titles similarly
        }

        // Home: Load Category
        function loadCategory(cat) {
            currentCategory = cat;
            const filtered = filterCardsByCategory(cat);
            const output = document.getElementById('home-output');
            output.innerHTML = `<h3>${cat.charAt(0).toUpperCase() + cat.slice(1)}</h3><p>${filtered.length} signs. Swipe to learn.</p>`;
            // Simulate quick preview
            const sample = filtered[0];
            output.innerHTML += `<div class="video-container">Preview: ${sample.front} / ${sample.back}</div>`;
        }

        // Learn Mode Functions
        function updateProgress() {
            progress.percentage = (progress.mastered / progress.total) * 100;
           